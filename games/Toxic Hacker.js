/*
@title: Toxic Hacker
@author: Nader (Nadooor)
@tags: [Hacking]
@addedOn: 2025-00-00
*/
const player = "p"
const Target = "t"
const usb = "u"
const anti = "a"
const Back = "b"

const melody = tune`
288.46153846153845: E5^288.46153846153845 + D5^288.46153846153845 + C5^288.46153846153845 + D4~288.46153846153845 + G5/288.46153846153845,
288.46153846153845: E5^288.46153846153845 + C5^288.46153846153845 + E4~288.46153846153845 + B5/288.46153846153845 + A5/288.46153846153845,
288.46153846153845: A5~288.46153846153845 + F5~288.46153846153845 + E4~288.46153846153845,
288.46153846153845: G5~288.46153846153845 + G4~288.46153846153845 + B4^288.46153846153845,
288.46153846153845: E5~288.46153846153845 + F4~288.46153846153845,
288.46153846153845: D5~288.46153846153845 + G4~288.46153846153845 + E4~288.46153846153845 + B5~288.46153846153845 + A5~288.46153846153845,
288.46153846153845: C5~288.46153846153845 + A4^288.46153846153845,
288.46153846153845: A4^288.46153846153845 + G4^288.46153846153845 + G5^288.46153846153845 + D4-288.46153846153845,
288.46153846153845: D5~288.46153846153845 + G4^288.46153846153845,
288.46153846153845: E5~288.46153846153845 + G4^288.46153846153845 + F4-288.46153846153845 + E4-288.46153846153845,
288.46153846153845: E5~288.46153846153845 + B5-288.46153846153845 + C4-288.46153846153845,
288.46153846153845: A4~288.46153846153845,
288.46153846153845: B4~288.46153846153845 + C5~288.46153846153845 + G5^288.46153846153845 + F5^288.46153846153845 + C4-288.46153846153845,
288.46153846153845: C5~288.46153846153845 + D5~288.46153846153845 + E5~288.46153846153845 + E4-288.46153846153845,
288.46153846153845: G4^288.46153846153845 + A5/288.46153846153845,
288.46153846153845: D5~288.46153846153845 + C5~288.46153846153845 + B4~288.46153846153845 + C4-288.46153846153845,
288.46153846153845: D4-288.46153846153845 + C4-288.46153846153845 + A5/288.46153846153845 + B4^288.46153846153845,
288.46153846153845: E5~288.46153846153845 + F5~288.46153846153845 + B4^288.46153846153845 + A4^288.46153846153845,
288.46153846153845: F5~288.46153846153845 + E4-288.46153846153845 + C5^288.46153846153845 + B4^288.46153846153845 + A4^288.46153846153845,
288.46153846153845: G5~288.46153846153845 + G4^288.46153846153845 + B4^288.46153846153845 + A4^288.46153846153845 + D5^288.46153846153845,
288.46153846153845: A5~288.46153846153845 + A4^288.46153846153845 + D5^288.46153846153845 + B4^288.46153846153845,
288.46153846153845: A5~288.46153846153845 + G5~288.46153846153845 + E4-288.46153846153845 + D5/288.46153846153845 + A4^288.46153846153845,
288.46153846153845: D5~288.46153846153845 + A4^288.46153846153845 + F4~288.46153846153845 + B5~288.46153846153845 + G4^288.46153846153845,
288.46153846153845: F5~288.46153846153845 + D4~288.46153846153845 + D5/288.46153846153845 + E5~288.46153846153845 + A4^288.46153846153845,
288.46153846153845: D4^288.46153846153845 + E4^288.46153846153845 + C5/288.46153846153845 + D5/288.46153846153845 + A5^288.46153846153845,
288.46153846153845: A5^288.46153846153845 + A4^288.46153846153845 + B4^288.46153846153845 + C5^288.46153846153845 + D5^288.46153846153845,
288.46153846153845: E4^288.46153846153845 + C5/288.46153846153845,
288.46153846153845: F4^288.46153846153845 + G5^288.46153846153845 + D5-288.46153846153845 + C5-288.46153846153845,
288.46153846153845: F4^288.46153846153845 + E4^288.46153846153845 + A5^288.46153846153845,
288.46153846153845: E5/288.46153846153845 + B4-288.46153846153845 + E4^288.46153846153845 + D4^288.46153846153845,
288.46153846153845: G4-288.46153846153845 + C4^288.46153846153845 + A5~288.46153846153845 + B5~288.46153846153845,
288.46153846153845: F5/288.46153846153845 + E5/288.46153846153845 + G4-288.46153846153845 + F4-288.46153846153845 + E4-288.46153846153845`
const win = tune`
41.551246537396125: B5-41.551246537396125 + A5-41.551246537396125 + G5-41.551246537396125 + F5-41.551246537396125,
41.551246537396125: B5-41.551246537396125 + A5-41.551246537396125 + G5-41.551246537396125 + F5-41.551246537396125,
41.551246537396125: A5-41.551246537396125 + B5-41.551246537396125 + G5-41.551246537396125 + F5-41.551246537396125,
41.551246537396125: A5-41.551246537396125 + B5-41.551246537396125 + G5-41.551246537396125 + F5-41.551246537396125,
207.75623268698064,
41.551246537396125: F5-41.551246537396125 + C5/41.551246537396125,
41.551246537396125: F5-41.551246537396125 + E5-41.551246537396125 + C5~41.551246537396125,
41.551246537396125: E5-41.551246537396125 + G4/41.551246537396125 + A4/41.551246537396125 + C5~41.551246537396125 + B4~41.551246537396125,
41.551246537396125: D5-41.551246537396125,
41.551246537396125: D5-41.551246537396125 + C5-41.551246537396125 + F4~41.551246537396125,
41.551246537396125: C5-41.551246537396125 + B4-41.551246537396125 + A4-41.551246537396125 + G5/41.551246537396125 + E4~41.551246537396125,
41.551246537396125: B4-41.551246537396125 + A4-41.551246537396125 + G4-41.551246537396125 + G5/41.551246537396125 + E4~41.551246537396125,
41.551246537396125: G4-41.551246537396125 + D4/41.551246537396125,
41.551246537396125: G4-41.551246537396125 + F4-41.551246537396125 + D4/41.551246537396125 + D5~41.551246537396125 + E5~41.551246537396125,
41.551246537396125: E4-41.551246537396125 + F4-41.551246537396125,
41.551246537396125: E4-41.551246537396125 + D4-41.551246537396125 + C5/41.551246537396125,
41.551246537396125: D4-41.551246537396125 + G4~41.551246537396125,
457.06371191135736`
const lwin = tune`
86.20689655172414: A5-86.20689655172414,
86.20689655172414: B5-86.20689655172414,
86.20689655172414: G5-86.20689655172414 + A5-86.20689655172414 + B5-86.20689655172414,
86.20689655172414: G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414 + A5-86.20689655172414 + B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414,
86.20689655172414: A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + B5-86.20689655172414,
86.20689655172414: B5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + G5-86.20689655172414,
86.20689655172414: G5-86.20689655172414 + A5-86.20689655172414,
86.20689655172414: A5-86.20689655172414 + B5-86.20689655172414`
addText("Move W,A,S,D/Reset J", { y: 4, color: color`H` });
const playback = playTune(melody, 5000)

setLegend(
  [ player, bitmap`
....00000.......
....0DDD00......
...00404D0......
...04444400.....
...33344400.....
..33004440....0.
.....00440....0.
......04400...0.
......044D000000
....000DDD4D40D0
..0004DD44440040
.00444444000040.
.000000000DD440.
.04444444444400.
.00000D000000...
......00........` ],
  [ Target, bitmap`
................
................
..000000000000..
..000000000000..
..040440404440..
..000000000000..
..044040444040..
..000000000000..
..040444040400..
..000000000000..
..000000000000..
......0LL0......
....000LL000....
....0LLLLLL0....
....00000000....
................` ],
  
  [ usb, bitmap`
....00000000....
....0LLLLLL0....
....0LLLLLL0....
....0L0LL0L0....
....0LLLLLL0....
..000000000000..
..0DDDDDDDDDD0..
..00DDD3DDDD00..
...0D3D3DD3D0...
...0D3D3DD3D0...
...0DD33D3DD0...
...0DDD33DDD0...
...0DDD33DDD0...
...00DDDDDD00...
....00DDDD00....
.....000000.....` ],
    [anti, bitmap`
.......00.......
.000..0110..000.
.010..0110..010.
.011001LL100110.
.01L11L06L11L10.
.01LLL0066LLL10.
.01L00006666L10.
.01L00006666L10.
.01L00006666L10.
.01L66660000L10.
.001L666000L100.
..001L6600L100..
...001L60L100...
....001LL100....
.....001100.....
......0000......`],
  [Back,bitmap`
0000D0000D00DDD0
D0D000D00D000000
D0D0D000000D0000
0000D00D0D00D0D0
000000D0000000D0
00D000D00D00D000
0000D0D00D00D000
0000D0000000D0D0
D0D0000D00D0D0D0
D00000000000D000
00000D0D0D0000D0
0D0D00000D000000
000D00000DD0D000
0D00000D0000D0D0
0D0D0D0000D000D0
000D00000D000000`]
  
)
setBackground(Back);
setSolids([player,usb,anti])

let level = 0
const levels = [
   map`
p...
.u..
....
...t`,
   map`
pa....
.a.u..
..aa..
..a..a
.....t`,
   map`
t....t
...aaa
......
......
aa.aua
p..a..
.u.a..
a..a..`,
   map`
t......ap.
aaaa...au.
....a..a..
.u..a..a.a
a.........
aaa.a.....
aaa..aa..a
t.....aaaa`,
   map`
p........a
aaaa.a.u.a
.....a....
..u..aaa..
aaa.at....
t....aaa..
t.....u...`,
   map`
p.aa..aa.
...a..a..
.u.a.uau.
..aaa.a..
..aaa....
..a......
.......a.
taaataaat`,]

  const currentLevel = levels[level];

setMap(currentLevel)

setPushables({
  [ player ]: [usb]
})

onInput("s", () => {
  getFirst(player).y += 1
})
onInput("w", () => {
  getFirst(player).y -= 1
})
onInput("a", () => {
  getFirst(player).x -= 1
})
onInput("d", () => {
  getFirst(player).x += 1
})
onInput("j", () => {
  const currentLevel = levels[level]; 
  if (currentLevel !== undefined) {
    clearText("");
    setMap(currentLevel);
  }
});
afterInput(() => {
  const targetNumber = tilesWith(Target).length;
  
  const numberCovered = tilesWith(Target, usb).length;

  if (numberCovered === targetNumber) {
    const playback = (win);
    clearText()
    level = level + 1;
    const currentLevel = levels[level];

    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("you win!", { y: 4, color: color`3` });
       playback.end();
      const playback = playTune(lwin);
      
    }
  }
});
